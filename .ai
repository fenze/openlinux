# OpenLinux Project Analysis

## Project Overview
OpenLinux is a lightweight Linux distribution designed for x86_64 and aarch64 processor architectures. This is an alpha-stage project (version 1.0.0-alpha) focused on creating a minimal, efficient Linux distribution from scratch.

**Author**: Kacper Fiedorowicz
**License**: MIT License
**Version**: 1.0.0-alpha

## Project Structure

### Root Directory: `/openlinux/src/`

```
openlinux/src/
├── .cache/              # Build cache directory
├── bin/                 # Core system binaries/utilities
├── build/               # Build output directory
├── include/             # System header files
├── lib/                 # System libraries
├── sys/                 # Linux kernel source (submodule)
├── tools/               # Build and packaging tools
├── config               # Main build configuration
├── makefile             # Main build file
├── readme               # Project description
├── license              # MIT license text
├── notes                # Development notes
├── todo                 # TODO list
├── .clang-format        # Code formatting rules
├── .gitignore           # Git ignore rules
├── .gitmodules          # Git submodules config
└── compile_commands.json # Clang compilation database
```

## Key Components

### 1. Build System (`config` + `makefile`)
- **Build Tool**: LLVM/Clang toolchain
- **Supported Architectures**: x86_64, aarch64, armv7-m
- **Current Default**: x86_64
- **Compiler**: Clang with LLD linker
- **Optimization**: Aggressive size optimization (-Oz, LTO, function/data sections)
- **Target**: Static binaries with no standard library dependencies
- **Parallel Builds**: -j8 by default

### 2. Libraries (`lib/`)

#### Core Libraries:
- **libc** (`lib/libc/`): Custom C standard library implementation
  - Architecture-specific code in `arch/x86_64/`, `arch/aarch64/`, etc.
  - Modular design with separate directories for each function group
  - Provides POSIX-compliant interfaces
  - Generates `libc.a` static library

- **libm** (`lib/libm/`): Math library implementation
- **libjson** (`lib/libjson/`): JSON parsing/generation library

#### Library Structure:
```
lib/libc/
├── arch/x86_64/        # Architecture-specific implementations
├── stdio/              # Standard I/O functions
├── stdlib/             # Standard library functions
├── string/             # String manipulation functions
├── unistd/             # UNIX standard functions
├── signal/             # Signal handling
├── thread/             # Threading support
└── [many more modules] # Each C library component
```

### 3. System Binaries (`bin/`)
Core UNIX utilities implemented as minimal static binaries:
- `cat`, `ls`, `pwd`, `echo`, `env`
- `clear`, `sleep`, `sync`, `yes`
- `true`, `false`, `nohup`, `unlink`
- `sh` (shell implementation)

Each binary has its own directory with:
- `makefile` (defines BIN and SRC variables)
- `*.c` source files
- Uses shared build configuration from root `config`

### 4. Header Files (`include/`)
Standard C and POSIX headers:
- Standard C: `stdio.h`, `stdlib.h`, `string.h`, `math.h`, etc.
- POSIX: `unistd.h`, `signal.h`, `sys/*`, `arpa/*`
- System-specific: `endian.h`, `limits.h`, `stdatomic.h`

### 5. Kernel (`sys/`)
Linux kernel source tree (likely as git submodule):
- Used to generate kernel headers for userspace
- Provides syscall interfaces and kernel API definitions
- Headers installed to `lib/libc/arch/$(ARCH)/include/`

### 6. Tools (`tools/`)
- **`package.sh`**: Creates distribution packages
- **`lint.sh`**: Code quality checking
- **`package.d/`**: Package definition scripts (currently empty)
- **`libc/`**: Libc-specific tools

## Build Process

### 1. Main Build Flow:
```bash
make all  # Default target
```

1. Creates build directory structure: `build/$(ARCH)/sysroot/`
2. Installs kernel headers from `sys/` to libc arch directory
3. Builds all enabled libraries (`LIBS = libc libm libjson`)
4. Builds all binaries in `bin/`
5. Creates rootfs tarball: `openlinux-$(VERSION)-$(ARCH)-rootfs.tar.gz`
6. Runs packaging script to create individual packages

### 2. Directory Layout After Build:
```
build/x86_64/sysroot/
├── usr/include/        # System headers
├── lib/               # Static libraries (libc.a, libm.a, etc.)
├── bin/               # System binaries
└── [other dirs]       # Additional system directories
```

### 3. Library Build Process:
Each library (e.g., libc):
1. Generates kernel headers if needed
2. Compiles all `.c` files in subdirectories
3. Compiles architecture-specific assembly (`.s` files)
4. Creates static archive (`.a` file)
5. Installs library and arch-specific headers to sysroot

### 4. Binary Build Process:
Each binary:
1. Compiles source files with system headers
2. Links statically against libc.a
3. Uses aggressive optimization flags
4. Installs to sysroot/bin/

## Configuration Options

### Architecture Support:
- `ARCH := x86_64` (default)
- `ARCH := aarch64`
- `ARCH := armv7-m`

### Compiler Settings:
- Target: `$(ARCH)-linux-eabi`
- No standard library (`-nostdlib -nostdinc -nodefaultlibs`)
- Size optimization (`-Oz -flto`)
- Static linking only

### Enabled Libraries:
- `LIBS := libc libm libjson` (configurable)

## Development Status

### Current State (TODO items):
- Fix `__vsnprintf` implementation issues
- Add missing `__vsnprintf` functionality
- Create package manifest format
- Add package manager
- Expand coreutils collection
- Integrate more libc components (libcrypt, etc.)

### Development Notes:
- Working on man page generation system
- Plans to fetch and parse OpenGroup specifications

## Key Features

### 1. Minimal Footprint:
- Aggressive compiler optimizations
- Static linking eliminates runtime dependencies
- Custom libc implementation removes glibc bloat

### 2. Multi-Architecture:
- Supports x86_64, aarch64, and ARM Cortex-M
- Architecture-specific optimizations and code

### 3. Modern Toolchain:
- LLVM/Clang compiler suite
- LLD linker for fast linking
- Ccache integration for faster rebuilds

### 4. Package System:
- Tarball-based root filesystem
- Modular package generation system
- Individual component packages

## Build Dependencies

### Required Tools:
- LLVM/Clang toolchain (`llvm-*` tools)
- GNU tar (`gtar`)
- rsync
- make
- Optional: ccache for faster builds

### System Requirements:
- POSIX-compliant build environment
- Sufficient disk space for kernel source and builds
- Network access for potential submodule updates

## Usage

### Basic Build:
```bash
cd openlinux/src
make clean    # Clean previous builds
make all      # Build everything
```

### Architecture-Specific Build:
```bash
# Edit config file to change ARCH
# OR
make ARCH=aarch64 all
```

### Individual Components:
```bash
make -C lib/libc        # Build just libc
make -C bin/ls          # Build just ls utility
```

## File Paths Reference

### Key Configuration Files:
- `openlinux/src/config` - Main build configuration
- `openlinux/src/makefile` - Root makefile
- `openlinux/src/.clang-format` - Code style configuration

### Important Directories:
- `openlinux/src/lib/libc/` - C library implementation
- `openlinux/src/bin/` - System utilities
- `openlinux/src/include/` - Public header files
- `openlinux/src/build/$(ARCH)/sysroot/` - Installation root
- `openlinux/src/sys/` - Linux kernel source

### Generated Files:
- `openlinux/src/build/$(ARCH)/openlinux-*-rootfs.tar.gz` - Root filesystem
- `openlinux/src/lib/libc/libc.a` - C library archive
- `openlinux/src/build/$(ARCH)/packages/*.pkg` - Individual packages

This project represents a comprehensive effort to build a minimal Linux distribution with a custom C library implementation, targeting multiple architectures while maintaining a small footprint and fast build times.
